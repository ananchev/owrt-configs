# Sensitive Information Management

This document describes how sensitive information is managed in this repository, including wireless credentials and SSH keys.

## List of Encrypted Files
The following files are encrypted with Ansible Vault and managed using git filters:
- `common/etc/config/wireless.key`
- `ssh/id_rsa_tomatoes`
- `common/etc/dropbear/authorized_keys`

## Adding a New Sensitive File
To add a new sensitive file to the repository:
1. Add the file to `.gitattributes`:
   ```
   <path/to/file> filter=ansible-vault
   ```
2. Stage the file using the command line:
   ```sh
   git add <file>
   ```
   You will be prompted for your Ansible Vault password. This ensures the file is encrypted in the git index, while your local copy remains decrypted.
3. Commit the staged file and updated `.gitattributes`:
   ```sh
   git commit -m "Add new sensitive file with encryption filter"
   ```
4. Never use the VS Code UI to stage sensitive files, as it may bypass the encryption filter.
5. If you clone the repository elsewhere, always configure the filter in your local `.git/config` (see `SETUP.md`) before adding or checking out sensitive files.

## Wireless File Clarifications
- The order of `option key` lines in `wireless.key` must match the order of `wifi-iface` sections in `wireless.main`.
- Do not include any `option key` lines in `wireless.main`.
- The merged `wireless` file is generated by combining `wireless.main` and `wireless.key` using the `merge_wireless.sh` script.
- All sensitive files (such as those above) are encrypted using Ansible Vault and managed with git filters for automatic encryption/decryption.

## Encryption & Decryption
- Files listed in `.gitattributes` with `filter=ansible-vault` are automatically encrypted on commit and decrypted on checkout.
- Manual encryption/decryption can be performed with:
  ```sh
  ansible-vault encrypt <file>
  ansible-vault decrypt <file>
  ```
- The vault password is labeled: **Ansible vault for home infrastructure**.

## Best Practices
- Never commit decrypted sensitive files to the repository.
- Always verify that sensitive files are encrypted before pushing changes.

## How to Add Sensitive Files
Always use the command line to add sensitive files:
```sh
git add <file>
```
This will prompt for your Ansible Vault password and stage the encrypted version. Your local file remains decrypted. Never use the VS Code UI to stage sensitive files.

## Git Filter Setup Reminder
After cloning, always add the filter section to your local `.git/config` to enable encryption/decryption:
```ini
[filter "ansible-vault"]
    clean = ./encrypt.sh
    smudge = ./decrypt.sh
```

See `CONFIG.md` for configuration file roles and `DEPLOY.md` for deployment instructions.
